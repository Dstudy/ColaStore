{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Visual%20studio%20code/CocaCola/ColaFE/src/components/ThreeViewer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport * as THREE from \"three\";\r\nimport { OrbitControls } from \"three/examples/jsm/Addons.js\";\r\nimport { GLTFLoader } from \"three/examples/jsm/Addons.js\";\r\n\r\ntype Props = {\r\n  modelUrl: string;\r\n};\r\n\r\nexport default function ThreeViewer({ modelUrl }: Props) {\r\n  const [error, setError] = React.useState<string | null>(null);\r\n  const mountRef = useRef<HTMLDivElement>(null);\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"flex items-center justify-center w-full h-full text-red-500 p-4 border border-red-500\">\r\n        {error}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!mountRef.current) return;\r\n\r\n    /* Scene */\r\n    const scene = new THREE.Scene();\r\n    scene.background = null;\r\n    const envTexture = new THREE.DataTexture(\r\n      new Uint8Array([255, 255, 255]),\r\n      1,\r\n      1,\r\n      THREE.RGBFormat\r\n    );\r\n    envTexture.needsUpdate = true;\r\n    scene.environment = envTexture;\r\n\r\n    /* Camera */\r\n    const camera = new THREE.PerspectiveCamera(\r\n      45,\r\n      mountRef.current.clientWidth / mountRef.current.clientHeight,\r\n      0.1,\r\n      100\r\n    );\r\n    camera.position.set(0, 0, 3);\r\n\r\n    /* Renderer */\r\n    const renderer = new THREE.WebGLRenderer({\r\n      antialias: true,\r\n      alpha: true,\r\n    });\r\n    renderer.setSize(\r\n      mountRef.current.clientWidth,\r\n      mountRef.current.clientHeight\r\n    );\r\n    renderer.setPixelRatio(window.devicePixelRatio);\r\n    mountRef.current.appendChild(renderer.domElement);\r\n    renderer.outputColorSpace = THREE.SRGBColorSpace;\r\n    renderer.toneMapping = THREE.ACESFilmicToneMapping;\r\n    renderer.toneMappingExposure = 1;\r\n\r\n    /* Lights */\r\n    scene.add(new THREE.AmbientLight(0xffffff, 1.2));\r\n    const dirLight = new THREE.DirectionalLight(0xffffff, 1);\r\n    dirLight.position.set(5, 5, 5);\r\n    scene.add(dirLight);\r\n\r\n    /* Controls (rotate only) */\r\n    const controls = new (OrbitControls as any)(camera, renderer.domElement);\r\n    controls.enableZoom = false;\r\n    controls.enablePan = false;\r\n    controls.autoRotate = false;\r\n    // Máº·c Ä‘á»‹nh táº¯t controls Ä‘á»ƒ trÃ¡nh xoay khi click ra ngoÃ i ngay tá»« Ä‘áº§u\r\n    controls.enabled = false;\r\n\r\n    /* Load GLTF */\r\n    const loader = new GLTFLoader();\r\n    // Biáº¿n Ä‘á»ƒ lÆ°u trá»¯ tham chiáº¿u Ä‘áº¿n model cho viá»‡c Raycasting\r\n    let loadedModel: THREE.Object3D | null = null;\r\n\r\n    loader.load(\r\n      modelUrl,\r\n      (gltf) => {\r\n        loadedModel = gltf.scene; // LÆ°u tham chiáº¿u model\r\n\r\n        /* ðŸ”¥ Auto-scale to fit */\r\n        const box = new THREE.Box3().setFromObject(loadedModel);\r\n        const size = box.getSize(new THREE.Vector3()).length();\r\n        const center = box.getCenter(new THREE.Vector3());\r\n\r\n        console.log(\"Model loaded. Size:\", size, \"Center:\", center);\r\n\r\n        if (size === 0) {\r\n          console.error(\"Model has 0 size. Check if it contains meshes.\");\r\n        }\r\n\r\n        loadedModel.position.set(0, -0.5, 0);\r\n        const scale = 1.5 / size || 1;\r\n        loadedModel.scale.setScalar(scale);\r\n\r\n        scene.add(loadedModel);\r\n        console.log(\"load model successfully\");\r\n      },\r\n      (xhr) => {\r\n        console.log((xhr.loaded / xhr.total) * 100 + \"% loaded\");\r\n      },\r\n      (error) => {\r\n        console.error(\"An error happened loading the model:\", error);\r\n        setError(\"Error loading model: \" + (error as Error).message);\r\n      }\r\n    );\r\n\r\n    /* ðŸ”¥ LOGIC Má»šI: Raycasting Ä‘á»ƒ kiá»ƒm tra click chuá»™t */\r\n    const raycaster = new THREE.Raycaster();\r\n    const mouse = new THREE.Vector2();\r\n\r\n    const onPointerDown = (event: PointerEvent) => {\r\n      // Náº¿u chÆ°a load xong model thÃ¬ khÃ´ng lÃ m gÃ¬ cáº£\r\n      if (!loadedModel) return;\r\n\r\n      // 1. TÃ­nh toÃ¡n tá»a Ä‘á»™ chuá»™t chuáº©n hÃ³a (Normalized Device Coordinates) (-1 Ä‘áº¿n +1)\r\n      const rect = renderer.domElement.getBoundingClientRect();\r\n      mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\r\n      mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;\r\n\r\n      // 2. Cáº­p nháº­t tia chiáº¿u tá»« camera\r\n      raycaster.setFromCamera(mouse, camera);\r\n\r\n      // 3. Kiá»ƒm tra va cháº¡m vá»›i model (recursive = true Ä‘á»ƒ kiá»ƒm tra táº¥t cáº£ mesh con)\r\n      const intersects = raycaster.intersectObject(loadedModel, true);\r\n\r\n      // 4. Náº¿u cÃ³ va cháº¡m -> Báº­t controls. KhÃ´ng thÃ¬ táº¯t.\r\n      if (intersects.length > 0) {\r\n        controls.enabled = true;\r\n      } else {\r\n        controls.enabled = false;\r\n      }\r\n    };\r\n\r\n    // Láº¯ng nghe sá»± kiá»‡n pointerdown (chuá»™t nháº¥n xuá»‘ng)\r\n    // Sá»­ dá»¥ng { capture: true } Ä‘á»ƒ Ä‘áº£m báº£o logic cá»§a ta cháº¡y trÆ°á»›c logic cá»§a OrbitControls\r\n    renderer.domElement.addEventListener(\"pointerdown\", onPointerDown, { capture: true });\r\n\r\n    /* Logic phá»¥: Khi nháº£ chuá»™t, ta cÃ³ thá»ƒ giá»¯ controls enabled hoáº·c táº¯t nÃ³.\r\n       Äá»ƒ tráº£i nghiá»‡m mÆ°á»£t mÃ , ta cá»© Ä‘á»ƒ nÃ³ enabled cho Ä‘áº¿n láº§n click tiáº¿p theo.\r\n       Tuy nhiÃªn, náº¿u muá»‘n cháº·t cháº½, báº¡n cÃ³ thá»ƒ thÃªm sá»± kiá»‡n pointerup. */\r\n\r\n    /* Animation */\r\n    const animate = () => {\r\n      requestAnimationFrame(animate);\r\n      controls.update();\r\n      renderer.render(scene, camera);\r\n    };\r\n    animate();\r\n\r\n    /* Resize */\r\n    const onResize = () => {\r\n      if (!mountRef.current) return;\r\n      camera.aspect =\r\n        mountRef.current.clientWidth / mountRef.current.clientHeight;\r\n      camera.updateProjectionMatrix();\r\n      renderer.setSize(\r\n        mountRef.current.clientWidth,\r\n        mountRef.current.clientHeight\r\n      );\r\n    };\r\n    window.addEventListener(\"resize\", onResize);\r\n\r\n    /* Cleanup */\r\n    return () => {\r\n      window.removeEventListener(\"resize\", onResize);\r\n      renderer.domElement.removeEventListener(\"pointerdown\", onPointerDown, { capture: true } as any);\r\n      renderer.dispose();\r\n      mountRef.current?.removeChild(renderer.domElement);\r\n    };\r\n  }, [modelUrl]);\r\n\r\n  return <div ref={mountRef} className=\"w-full h-full\" />;\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AACA;AALA;;;;;;AAWe,SAAS,YAAY,EAAE,QAAQ,EAAS;IACrD,MAAM,CAAC,OAAO,SAAS,GAAG,gNAAK,CAAC,QAAQ,CAAgB;IACxD,MAAM,WAAW,IAAA,+MAAM,EAAiB;IAExC,IAAI,OAAO;QACT,qBACE,8OAAC;YAAI,WAAU;sBACZ;;;;;;IAGP;IAEA,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,SAAS,OAAO,EAAE;QAEvB,SAAS,GACT,MAAM,QAAQ,IAAI,wJAAW;QAC7B,MAAM,UAAU,GAAG;QACnB,MAAM,aAAa,IAAI,8JAAiB,CACtC,IAAI,WAAW;YAAC;YAAK;YAAK;SAAI,GAC9B,GACA,GACA,4JAAe;QAEjB,WAAW,WAAW,GAAG;QACzB,MAAM,WAAW,GAAG;QAEpB,UAAU,GACV,MAAM,SAAS,IAAI,oKAAuB,CACxC,IACA,SAAS,OAAO,CAAC,WAAW,GAAG,SAAS,OAAO,CAAC,YAAY,EAC5D,KACA;QAEF,OAAO,QAAQ,CAAC,GAAG,CAAC,GAAG,GAAG;QAE1B,YAAY,GACZ,MAAM,WAAW,IAAI,kLAAmB,CAAC;YACvC,WAAW;YACX,OAAO;QACT;QACA,SAAS,OAAO,CACd,SAAS,OAAO,CAAC,WAAW,EAC5B,SAAS,OAAO,CAAC,YAAY;QAE/B,SAAS,aAAa,CAAC,OAAO,gBAAgB;QAC9C,SAAS,OAAO,CAAC,WAAW,CAAC,SAAS,UAAU;QAChD,SAAS,gBAAgB,GAAG,iKAAoB;QAChD,SAAS,WAAW,GAAG,wKAA2B;QAClD,SAAS,mBAAmB,GAAG;QAE/B,UAAU,GACV,MAAM,GAAG,CAAC,IAAI,+JAAkB,CAAC,UAAU;QAC3C,MAAM,WAAW,IAAI,mKAAsB,CAAC,UAAU;QACtD,SAAS,QAAQ,CAAC,GAAG,CAAC,GAAG,GAAG;QAC5B,MAAM,GAAG,CAAC;QAEV,0BAA0B,GAC1B,MAAM,WAAW,IAAK,sLAAa,CAAS,QAAQ,SAAS,UAAU;QACvE,SAAS,UAAU,GAAG;QACtB,SAAS,SAAS,GAAG;QACrB,SAAS,UAAU,GAAG;QACtB,qEAAqE;QACrE,SAAS,OAAO,GAAG;QAEnB,aAAa,GACb,MAAM,SAAS,IAAI,+KAAU;QAC7B,2DAA2D;QAC3D,IAAI,cAAqC;QAEzC,OAAO,IAAI,CACT,UACA,CAAC;YACC,cAAc,KAAK,KAAK,EAAE,uBAAuB;YAEjD,wBAAwB,GACxB,MAAM,MAAM,IAAI,uJAAU,GAAG,aAAa,CAAC;YAC3C,MAAM,OAAO,IAAI,OAAO,CAAC,IAAI,0JAAa,IAAI,MAAM;YACpD,MAAM,SAAS,IAAI,SAAS,CAAC,IAAI,0JAAa;YAE9C,QAAQ,GAAG,CAAC,uBAAuB,MAAM,WAAW;YAEpD,IAAI,SAAS,GAAG;gBACd,QAAQ,KAAK,CAAC;YAChB;YAEA,YAAY,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,KAAK;YAClC,MAAM,QAAQ,MAAM,QAAQ;YAC5B,YAAY,KAAK,CAAC,SAAS,CAAC;YAE5B,MAAM,GAAG,CAAC;YACV,QAAQ,GAAG,CAAC;QACd,GACA,CAAC;YACC,QAAQ,GAAG,CAAC,AAAC,IAAI,MAAM,GAAG,IAAI,KAAK,GAAI,MAAM;QAC/C,GACA,CAAC;YACC,QAAQ,KAAK,CAAC,wCAAwC;YACtD,SAAS,0BAA0B,AAAC,MAAgB,OAAO;QAC7D;QAGF,oDAAoD,GACpD,MAAM,YAAY,IAAI,4JAAe;QACrC,MAAM,QAAQ,IAAI,0JAAa;QAE/B,MAAM,gBAAgB,CAAC;YACrB,+CAA+C;YAC/C,IAAI,CAAC,aAAa;YAElB,kFAAkF;YAClF,MAAM,OAAO,SAAS,UAAU,CAAC,qBAAqB;YACtD,MAAM,CAAC,GAAG,AAAC,CAAC,MAAM,OAAO,GAAG,KAAK,IAAI,IAAI,KAAK,KAAK,GAAI,IAAI;YAC3D,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,OAAO,GAAG,KAAK,GAAG,IAAI,KAAK,MAAM,IAAI,IAAI;YAE5D,kCAAkC;YAClC,UAAU,aAAa,CAAC,OAAO;YAE/B,+EAA+E;YAC/E,MAAM,aAAa,UAAU,eAAe,CAAC,aAAa;YAE1D,oDAAoD;YACpD,IAAI,WAAW,MAAM,GAAG,GAAG;gBACzB,SAAS,OAAO,GAAG;YACrB,OAAO;gBACL,SAAS,OAAO,GAAG;YACrB;QACF;QAEA,mDAAmD;QACnD,uFAAuF;QACvF,SAAS,UAAU,CAAC,gBAAgB,CAAC,eAAe,eAAe;YAAE,SAAS;QAAK;QAEnF;;wEAEoE,GAEpE,aAAa,GACb,MAAM,UAAU;YACd,sBAAsB;YACtB,SAAS,MAAM;YACf,SAAS,MAAM,CAAC,OAAO;QACzB;QACA;QAEA,UAAU,GACV,MAAM,WAAW;YACf,IAAI,CAAC,SAAS,OAAO,EAAE;YACvB,OAAO,MAAM,GACX,SAAS,OAAO,CAAC,WAAW,GAAG,SAAS,OAAO,CAAC,YAAY;YAC9D,OAAO,sBAAsB;YAC7B,SAAS,OAAO,CACd,SAAS,OAAO,CAAC,WAAW,EAC5B,SAAS,OAAO,CAAC,YAAY;QAEjC;QACA,OAAO,gBAAgB,CAAC,UAAU;QAElC,WAAW,GACX,OAAO;YACL,OAAO,mBAAmB,CAAC,UAAU;YACrC,SAAS,UAAU,CAAC,mBAAmB,CAAC,eAAe,eAAe;gBAAE,SAAS;YAAK;YACtF,SAAS,OAAO;YAChB,SAAS,OAAO,EAAE,YAAY,SAAS,UAAU;QACnD;IACF,GAAG;QAAC;KAAS;IAEb,qBAAO,8OAAC;QAAI,KAAK;QAAU,WAAU;;;;;;AACvC"}}]
}