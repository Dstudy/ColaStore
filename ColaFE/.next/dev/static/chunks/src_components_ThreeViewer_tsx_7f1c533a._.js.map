{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Visual%20studio%20code/CocaCola/ColaFE/src/components/ThreeViewer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport * as THREE from \"three\";\r\nimport { OrbitControls } from \"three/examples/jsm/Addons.js\";\r\nimport { GLTFLoader } from \"three/examples/jsm/Addons.js\";\r\n\r\ntype Props = {\r\n  modelUrl: string;\r\n};\r\n\r\nexport default function ThreeViewer({ modelUrl }: Props) {\r\n  const [error, setError] = React.useState<string | null>(null);\r\n  const mountRef = useRef<HTMLDivElement>(null);\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"flex items-center justify-center w-full h-full text-red-500 p-4 border border-red-500\">\r\n        {error}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!mountRef.current) return;\r\n\r\n    /* Scene */\r\n    const scene = new THREE.Scene();\r\n    scene.background = null;\r\n    const envTexture = new THREE.DataTexture(\r\n      new Uint8Array([255, 255, 255]),\r\n      1,\r\n      1,\r\n      THREE.RGBFormat\r\n    );\r\n    envTexture.needsUpdate = true;\r\n    scene.environment = envTexture;\r\n\r\n    /* Camera */\r\n    const camera = new THREE.PerspectiveCamera(\r\n      45,\r\n      mountRef.current.clientWidth / mountRef.current.clientHeight,\r\n      0.1,\r\n      100\r\n    );\r\n    camera.position.set(0, 0, 3);\r\n\r\n    /* Renderer */\r\n    const renderer = new THREE.WebGLRenderer({\r\n      antialias: true,\r\n      alpha: true,\r\n    });\r\n    renderer.setSize(\r\n      mountRef.current.clientWidth,\r\n      mountRef.current.clientHeight\r\n    );\r\n    renderer.setPixelRatio(window.devicePixelRatio);\r\n    mountRef.current.appendChild(renderer.domElement);\r\n    renderer.outputColorSpace = THREE.SRGBColorSpace;\r\n    renderer.toneMapping = THREE.ACESFilmicToneMapping;\r\n    renderer.toneMappingExposure = 1;\r\n\r\n    /* Lights */\r\n    scene.add(new THREE.AmbientLight(0xffffff, 1.2));\r\n    const dirLight = new THREE.DirectionalLight(0xffffff, 1);\r\n    dirLight.position.set(5, 5, 5);\r\n    scene.add(dirLight);\r\n\r\n    /* Controls (rotate only) */\r\n    const controls = new (OrbitControls as any)(camera, renderer.domElement);\r\n    controls.enableZoom = false;\r\n    controls.enablePan = false;\r\n    controls.autoRotate = false;\r\n    // Máº·c Ä‘á»‹nh táº¯t controls Ä‘á»ƒ trÃ¡nh xoay khi click ra ngoÃ i ngay tá»« Ä‘áº§u\r\n    controls.enabled = false;\r\n\r\n    /* Load GLTF */\r\n    const loader = new GLTFLoader();\r\n    // Biáº¿n Ä‘á»ƒ lÆ°u trá»¯ tham chiáº¿u Ä‘áº¿n model cho viá»‡c Raycasting\r\n    let loadedModel: THREE.Object3D | null = null;\r\n\r\n    loader.load(\r\n      modelUrl,\r\n      (gltf) => {\r\n        loadedModel = gltf.scene; // LÆ°u tham chiáº¿u model\r\n\r\n        /* ðŸ”¥ Auto-scale to fit */\r\n        const box = new THREE.Box3().setFromObject(loadedModel);\r\n        const size = box.getSize(new THREE.Vector3()).length();\r\n        const center = box.getCenter(new THREE.Vector3());\r\n\r\n        console.log(\"Model loaded. Size:\", size, \"Center:\", center);\r\n\r\n        if (size === 0) {\r\n          console.error(\"Model has 0 size. Check if it contains meshes.\");\r\n        }\r\n\r\n        loadedModel.position.set(0, -0.5, 0);\r\n        const scale = 1.5 / size || 1;\r\n        loadedModel.scale.setScalar(scale);\r\n\r\n        scene.add(loadedModel);\r\n        console.log(\"load model successfully\");\r\n      },\r\n      (xhr) => {\r\n        console.log((xhr.loaded / xhr.total) * 100 + \"% loaded\");\r\n      },\r\n      (error) => {\r\n        console.error(\"An error happened loading the model:\", error);\r\n        setError(\"Error loading model: \" + (error as Error).message);\r\n      }\r\n    );\r\n\r\n    /* ðŸ”¥ LOGIC Má»šI: Raycasting Ä‘á»ƒ kiá»ƒm tra click chuá»™t */\r\n    const raycaster = new THREE.Raycaster();\r\n    const mouse = new THREE.Vector2();\r\n\r\n    const onPointerDown = (event: PointerEvent) => {\r\n      // Náº¿u chÆ°a load xong model thÃ¬ khÃ´ng lÃ m gÃ¬ cáº£\r\n      if (!loadedModel) return;\r\n\r\n      // 1. TÃ­nh toÃ¡n tá»a Ä‘á»™ chuá»™t chuáº©n hÃ³a (Normalized Device Coordinates) (-1 Ä‘áº¿n +1)\r\n      const rect = renderer.domElement.getBoundingClientRect();\r\n      mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\r\n      mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;\r\n\r\n      // 2. Cáº­p nháº­t tia chiáº¿u tá»« camera\r\n      raycaster.setFromCamera(mouse, camera);\r\n\r\n      // 3. Kiá»ƒm tra va cháº¡m vá»›i model (recursive = true Ä‘á»ƒ kiá»ƒm tra táº¥t cáº£ mesh con)\r\n      const intersects = raycaster.intersectObject(loadedModel, true);\r\n\r\n      // 4. Náº¿u cÃ³ va cháº¡m -> Báº­t controls. KhÃ´ng thÃ¬ táº¯t.\r\n      if (intersects.length > 0) {\r\n        controls.enabled = true;\r\n      } else {\r\n        controls.enabled = false;\r\n      }\r\n    };\r\n\r\n    // Láº¯ng nghe sá»± kiá»‡n pointerdown (chuá»™t nháº¥n xuá»‘ng)\r\n    // Sá»­ dá»¥ng { capture: true } Ä‘á»ƒ Ä‘áº£m báº£o logic cá»§a ta cháº¡y trÆ°á»›c logic cá»§a OrbitControls\r\n    renderer.domElement.addEventListener(\"pointerdown\", onPointerDown, { capture: true });\r\n\r\n    /* Logic phá»¥: Khi nháº£ chuá»™t, ta cÃ³ thá»ƒ giá»¯ controls enabled hoáº·c táº¯t nÃ³.\r\n       Äá»ƒ tráº£i nghiá»‡m mÆ°á»£t mÃ , ta cá»© Ä‘á»ƒ nÃ³ enabled cho Ä‘áº¿n láº§n click tiáº¿p theo.\r\n       Tuy nhiÃªn, náº¿u muá»‘n cháº·t cháº½, báº¡n cÃ³ thá»ƒ thÃªm sá»± kiá»‡n pointerup. */\r\n\r\n    /* Animation */\r\n    const animate = () => {\r\n      requestAnimationFrame(animate);\r\n      controls.update();\r\n      renderer.render(scene, camera);\r\n    };\r\n    animate();\r\n\r\n    /* Resize */\r\n    const onResize = () => {\r\n      if (!mountRef.current) return;\r\n      camera.aspect =\r\n        mountRef.current.clientWidth / mountRef.current.clientHeight;\r\n      camera.updateProjectionMatrix();\r\n      renderer.setSize(\r\n        mountRef.current.clientWidth,\r\n        mountRef.current.clientHeight\r\n      );\r\n    };\r\n    window.addEventListener(\"resize\", onResize);\r\n\r\n    /* Cleanup */\r\n    return () => {\r\n      window.removeEventListener(\"resize\", onResize);\r\n      renderer.domElement.removeEventListener(\"pointerdown\", onPointerDown, { capture: true } as any);\r\n      renderer.dispose();\r\n      mountRef.current?.removeChild(renderer.domElement);\r\n    };\r\n  }, [modelUrl]);\r\n\r\n  return <div ref={mountRef} className=\"w-full h-full\" />;\r\n}"],"names":[],"mappings":"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"}}]
}