{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Visual%20studio%20code/CocaCola/ColaFE/src/app/account/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { toast } from \"react-toastify\";\r\n\r\ninterface UserData {\r\n  id: number;\r\n  fullname: string;\r\n  email: string;\r\n  role_id: string;\r\n}\r\n\r\ninterface UpdateUserResponse {\r\n  errCode: number;\r\n  message: string;\r\n  user?: UserData;\r\n}\r\n\r\ninterface UpdatePasswordResponse {\r\n  errCode: number;\r\n  message: string;\r\n  user?: UserData;\r\n}\r\n\r\nexport default function AccountPage() {\r\n  const router = useRouter();\r\n  const [user, setUser] = useState<UserData | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  \r\n  // Profile update form\r\n  const [fullname, setFullname] = useState(\"\");\r\n  const [email, setEmail] = useState(\"\");\r\n  const [isUpdatingProfile, setIsUpdatingProfile] = useState(false);\r\n  \r\n  // Password change form\r\n  const [oldPassword, setOldPassword] = useState(\"\");\r\n  const [newPassword, setNewPassword] = useState(\"\");\r\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\r\n  const [isChangingPassword, setIsChangingPassword] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem(\"auth_token\");\r\n    const userStr = localStorage.getItem(\"user\");\r\n\r\n    if (!token || !userStr) {\r\n      router.push(\"/login\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const userData: UserData = JSON.parse(userStr);\r\n      setUser(userData);\r\n      setFullname(userData.fullname);\r\n      setEmail(userData.email);\r\n    } catch (error) {\r\n      console.error(\"Error parsing user data:\", error);\r\n      router.push(\"/login\");\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [router]);\r\n\r\n  const handleUpdateProfile = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!fullname.trim() || !email.trim()) {\r\n      toast.error(\"Name and email are required\");\r\n      return;\r\n    }\r\n\r\n    if (!user) return;\r\n\r\n    setIsUpdatingProfile(true);\r\n    try {\r\n      const token = localStorage.getItem(\"auth_token\");\r\n      const response = await fetch(\"http://localhost:8800/api/update-user\", {\r\n        method: \"PUT\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n        body: JSON.stringify({\r\n          id: user.id,\r\n          fullname: fullname.trim(),\r\n          email: email.trim(),\r\n        }),\r\n      });\r\n\r\n      const data: UpdateUserResponse = await response.json();\r\n\r\n      if (data.errCode !== 0) {\r\n        toast.error(data.message || \"Failed to update profile\");\r\n        return;\r\n      }\r\n\r\n      if (data.user) {\r\n        // Update localStorage\r\n        localStorage.setItem(\"user\", JSON.stringify(data.user));\r\n        setUser(data.user);\r\n        toast.success(\"Profile updated successfully!\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error updating profile:\", error);\r\n      toast.error(\"Something went wrong. Please try again.\");\r\n    } finally {\r\n      setIsUpdatingProfile(false);\r\n    }\r\n  };\r\n\r\n  const handleChangePassword = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!oldPassword || !newPassword || !confirmPassword) {\r\n      toast.error(\"All password fields are required\");\r\n      return;\r\n    }\r\n\r\n    if (newPassword.length < 6) {\r\n      toast.error(\"New password must be at least 6 characters long\");\r\n      return;\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      toast.error(\"New passwords do not match\");\r\n      return;\r\n    }\r\n\r\n    if (oldPassword === newPassword) {\r\n      toast.error(\"New password must be different from current password\");\r\n      return;\r\n    }\r\n\r\n    if (!user) return;\r\n\r\n    setIsChangingPassword(true);\r\n    try {\r\n      const token = localStorage.getItem(\"auth_token\");\r\n      const response = await fetch(\r\n        \"http://localhost:8800/api/update-user-password\",\r\n        {\r\n          method: \"PUT\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${token}`,\r\n          },\r\n          body: JSON.stringify({\r\n            id: user.id,\r\n            oldPassword: oldPassword,\r\n            newPassword: newPassword,\r\n          }),\r\n        }\r\n      );\r\n\r\n      const data: UpdatePasswordResponse = await response.json();\r\n\r\n      if (data.errCode !== 0) {\r\n        toast.error(data.message || \"Failed to change password\");\r\n        return;\r\n      }\r\n\r\n      toast.success(\"Password changed successfully!\");\r\n      // Clear password fields\r\n      setOldPassword(\"\");\r\n      setNewPassword(\"\");\r\n      setConfirmPassword(\"\");\r\n    } catch (error) {\r\n      console.error(\"Error changing password:\", error);\r\n      toast.error(\"Something went wrong. Please try again.\");\r\n    } finally {\r\n      setIsChangingPassword(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <main className=\"min-h-screen flex items-center justify-center bg-gray-50\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-gray-600\">Loading...</p>\r\n        </div>\r\n      </main>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <main className=\"min-h-screen bg-gray-50 py-12\">\r\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n        <div className=\"mb-8\">\r\n          <h1 className=\"text-3xl font-bold text-gray-900\">Manage Account</h1>\r\n          <p className=\"mt-2 text-sm text-gray-600\">\r\n            Update your profile information and change your password\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"space-y-6\">\r\n          {/* Profile Update Section */}\r\n          <div className=\"bg-white shadow-lg rounded-xl p-8\">\r\n            <h2 className=\"text-xl font-semibold mb-6 text-gray-900\">\r\n              Profile Information\r\n            </h2>\r\n            <form onSubmit={handleUpdateProfile} className=\"space-y-4\">\r\n              <div>\r\n                <label\r\n                  htmlFor=\"fullname\"\r\n                  className=\"block text-sm font-medium text-gray-700 mb-1\"\r\n                >\r\n                  Full Name\r\n                </label>\r\n                <input\r\n                  id=\"fullname\"\r\n                  type=\"text\"\r\n                  value={fullname}\r\n                  onChange={(e) => setFullname(e.target.value)}\r\n                  className=\"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-black focus:outline-none focus:ring-1 focus:ring-black\"\r\n                  placeholder=\"Enter your full name\"\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label\r\n                  htmlFor=\"email\"\r\n                  className=\"block text-sm font-medium text-gray-700 mb-1\"\r\n                >\r\n                  Email Address\r\n                </label>\r\n                <input\r\n                  id=\"email\"\r\n                  type=\"email\"\r\n                  value={email}\r\n                  onChange={(e) => setEmail(e.target.value)}\r\n                  className=\"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-black focus:outline-none focus:ring-1 focus:ring-black\"\r\n                  placeholder=\"you@example.com\"\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isUpdatingProfile}\r\n                className=\"w-full sm:w-auto px-6 py-2 bg-black text-white rounded-md hover:bg-gray-900 transition-colors disabled:opacity-60 disabled:cursor-not-allowed text-sm font-medium\"\r\n              >\r\n                {isUpdatingProfile ? \"Updating...\" : \"Update Profile\"}\r\n              </button>\r\n            </form>\r\n          </div>\r\n\r\n          {/* Password Change Section */}\r\n          <div className=\"bg-white shadow-lg rounded-xl p-8\">\r\n            <h2 className=\"text-xl font-semibold mb-6 text-gray-900\">\r\n              Change Password\r\n            </h2>\r\n            <form onSubmit={handleChangePassword} className=\"space-y-4\">\r\n              <div>\r\n                <label\r\n                  htmlFor=\"oldPassword\"\r\n                  className=\"block text-sm font-medium text-gray-700 mb-1\"\r\n                >\r\n                  Current Password\r\n                </label>\r\n                <input\r\n                  id=\"oldPassword\"\r\n                  type=\"password\"\r\n                  value={oldPassword}\r\n                  onChange={(e) => setOldPassword(e.target.value)}\r\n                  className=\"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-black focus:outline-none focus:ring-1 focus:ring-black\"\r\n                  placeholder=\"Enter current password\"\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label\r\n                  htmlFor=\"newPassword\"\r\n                  className=\"block text-sm font-medium text-gray-700 mb-1\"\r\n                >\r\n                  New Password\r\n                </label>\r\n                <input\r\n                  id=\"newPassword\"\r\n                  type=\"password\"\r\n                  value={newPassword}\r\n                  onChange={(e) => setNewPassword(e.target.value)}\r\n                  className=\"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-black focus:outline-none focus:ring-1 focus:ring-black\"\r\n                  placeholder=\"Enter new password (min. 6 characters)\"\r\n                  required\r\n                  minLength={6}\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label\r\n                  htmlFor=\"confirmPassword\"\r\n                  className=\"block text-sm font-medium text-gray-700 mb-1\"\r\n                >\r\n                  Confirm New Password\r\n                </label>\r\n                <input\r\n                  id=\"confirmPassword\"\r\n                  type=\"password\"\r\n                  value={confirmPassword}\r\n                  onChange={(e) => setConfirmPassword(e.target.value)}\r\n                  className=\"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-black focus:outline-none focus:ring-1 focus:ring-black\"\r\n                  placeholder=\"Confirm new password\"\r\n                  required\r\n                  minLength={6}\r\n                />\r\n              </div>\r\n\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isChangingPassword}\r\n                className=\"w-full sm:w-auto px-6 py-2 bg-black text-white rounded-md hover:bg-gray-900 transition-colors disabled:opacity-60 disabled:cursor-not-allowed text-sm font-medium\"\r\n              >\r\n                {isChangingPassword ? \"Changing...\" : \"Change Password\"}\r\n              </button>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}